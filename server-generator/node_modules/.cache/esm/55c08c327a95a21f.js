let ApolloServer,path,mergeResolvers,mergeTypes,fileLoader,schemaDirectives,dbConnect,models,IN_PROD,CLIENT_ADDR,CLIENT_PORT,addUser;_7a9‍.w("apollo-server",[["ApolloServer",["ApolloServer"],function(v){ApolloServer=v}]]);_7a9‍.w("path",[["default",["path"],function(v){path=v}]]);_7a9‍.w("merge-graphql-schemas",[["mergeResolvers",["mergeResolvers"],function(v){mergeResolvers=v}],["mergeTypes",["mergeTypes"],function(v){mergeTypes=v}],["fileLoader",["fileLoader"],function(v){fileLoader=v}]]);_7a9‍.w("./directives",[["schemaDirectives",["schemaDirectives"],function(v){schemaDirectives=v}]]);_7a9‍.w("./utils/dbConnect",[["dbConnect",["dbConnect"],function(v){dbConnect=v}]]);_7a9‍.w("./models",[["models",["models"],function(v){models=v}]]);_7a9‍.w("./config",[["IN_PROD",["IN_PROD"],function(v){IN_PROD=v}],["CLIENT_ADDR",["CLIENT_ADDR"],function(v){CLIENT_ADDR=v}],["CLIENT_PORT",["CLIENT_PORT"],function(v){CLIENT_PORT=v}]]);_7a9‍.w("./utils/addUser",[["addUser",["addUser"],function(v){addUser=v}]]);










(() => {
  const typeDefs = mergeTypes(fileLoader(path.join(__dirname, './typeDefs')))
  const resolvers = mergeResolvers(fileLoader(path.join(__dirname, './resolvers')))

  const server = new ApolloServer({
    cors: {
      origin: `http://${CLIENT_ADDR}:${CLIENT_PORT}`,
      credentials: true,
    },
    typeDefs,
    resolvers,
    schemaDirectives,
    playground: IN_PROD ? false : {
      settings: {
        'request.credentials': 'include',
      }
    },
    context: async ({ req }) => {
      const user = await addUser(req) || ''
      return {
        req,
        models,
        user: user,
      }
    }
  })

  try {
    server.listen({ port: process.env.SERVER_PORT }).then(({ url }) => {
      console.log(`🚀  Server ready at ${url}`)
    })
    dbConnect()
  } catch (err) {
    console.error(`server error: ${err}`)
  }
})()
